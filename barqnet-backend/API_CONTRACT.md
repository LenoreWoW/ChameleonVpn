# BarqNet API Contract

This document describes the REST API endpoints for the BarqNet VPN system, designed to work with BarqNet client applications. ## Base URL ``` http://your-server:8080 ``` ## Authentication All endpoints (except `/auth/*` and `/health`) require authentication via Bearer token. ``` Authorization: Bearer <jwt_token> ``` ## API Endpoints ### Authentication Endpoints #### POST /auth/login Authenticate a user and receive a JWT token. **Request:** ```json { "username": "john", "password": "password123" } ``` **Response:** ```json { "success": true, "token": "jwt_john_1640995200", "user": { "username": "john", "active": true } } ``` #### POST /auth/register Register a new user account. **Request:** ```json { "username": "alice", "password": "password123", "email": "alice@example.com" } ``` **Response:** ```json { "success": true, "message": "User created successfully", "user": { "username": "alice", "active": true } } ``` #### POST /auth/otp Verify OTP for two-factor authentication. **Request:** ```json { "username": "john", "otp": "123456" } ``` **Response:** ```json { "success": true, "message": "OTP verified" } ``` #### POST /auth/refresh Refresh an expired JWT token. **Request:** ```json { "token": "jwt_john_1640995200" } ``` **Response:** ```json { "success": true, "token": "jwt_john_1640995300" } ``` ### VPN Configuration Endpoints #### GET /vpn/config Get VPN configuration for a user. **Query Parameters:** - `username` (required): Username to get config for **Response:** ```json { "success": true, "config": { "server": "198.51.100.10", "port": 1194, "protocol": "udp", "ovpn": "client\ndev tun\nproto udp\nremote 198.51.100.10 1194\n...", "checksum": "a1b2c3d4e5f6..." } } ``` #### GET /vpn/locations Get available server locations. **Response:** ```json { "success": true, "locations": ["us-east", "europe", "asia", "us-west"] } ``` ### VPN Status and Statistics #### POST /vpn/status Update VPN connection status. **Request:** ```json { "username": "john", "status": "connected", "server": "198.51.100.10", "duration": 3600 } ``` **Response:** ```json { "success": true, "message": "Status updated" } ``` **Status Values:** - `connected`: VPN is connected - `disconnected`: VPN is disconnected - `connecting`: VPN is connecting - `error`: Connection error #### POST /vpn/stats Send VPN usage statistics. **Request:** ```json { "username": "john", "bytes_in": 1048576, "bytes_out": 524288, "duration": 3600, "server": "198.51.100.10" } ``` **Response:** ```json { "success": true, "message": "Statistics recorded" } ``` ### User Management #### GET /user/profile Get user profile information. **Query Parameters:** - `username` (required): Username to get profile for **Response:** ```json { "success": true, "user": { "username": "john", "active": true, "port": 1194, "protocol": "udp", "created": "2024-01-01T00:00:00Z", "expires": "2025-01-01T00:00:00Z" } } ``` #### POST /user/update Update user settings. **Request:** ```json { "username": "john", "port": 443, "protocol": "tcp" } ``` **Response:** ```json { "success": true, "message": "User updated successfully" } ``` ### Health Check #### GET /health Check API server health. **Response:** ```json { "status": "healthy", "timestamp": 1640995200, "version": "1.0.0" } ``` ## Error Responses All endpoints may return error responses in the following format: ```json { "success": false, "error": "Error message", "code": 400 } ``` **Common HTTP Status Codes:** - `200`: Success - `400`: Bad Request - `401`: Unauthorized - `404`: Not Found - `409`: Conflict - `500`: Internal Server Error ## CORS Support All endpoints support CORS with the following headers: - `Access-Control-Allow-Origin: *` - `Access-Control-Allow-Methods: GET, POST, PUT, DELETE, OPTIONS` - `Access-Control-Allow-Headers: Content-Type, Authorization` ## Rate Limiting API requests are rate-limited to prevent abuse: - **Authentication endpoints**: 5 requests per minute per IP - **Other endpoints**: 100 requests per minute per IP ## Security Features - **JWT Tokens**: Secure authentication - **HTTPS Support**: All production endpoints should use HTTPS - **Input Validation**: All inputs are validated and sanitized - **Audit Logging**: All API calls are logged for security monitoring ## Client Integration Examples ### JavaScript/TypeScript ```javascript // Login and get token const response = await fetch('http://your-server:8080/auth/login', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ username: 'john', password: 'password123' }) }); const { token } = await response.json(); // Get VPN config const configResponse = await fetch('http://your-server:8080/vpn/config?username=john', { headers: { 'Authorization': `Bearer ${token}` } }); const { config } = await configResponse.json(); ``` ### Android (Kotlin) ```kotlin // Using Retrofit or similar HTTP client @POST("/auth/login") suspend fun login(@Body request: LoginRequest): Response<LoginResponse> @GET("/vpn/config") suspend fun getVPNConfig( @Query("username") username: String, @Header("Authorization") token: String ): Response<VPNConfigResponse> ``` ### iOS (Swift) ```swift // Using URLSession or similar func login(username: String, password: String) async throws -> LoginResponse { let url = URL(string: "http://your-server:8080/auth/login")! var request = URLRequest(url: url) request.httpMethod = "POST" request.setValue("application/json", forHTTPHeaderField: "Content-Type") let body = ["username": username, "password": password] request.httpBody = try JSONSerialization.data(withJSONObject: body) let (data, _) = try await URLSession.shared.data(for: request) return try JSONDecoder().decode(LoginResponse.self, from: data) } ``` ## Testing Use the following commands to test the API: ```bash # Start API server sudo vpnmanager start-api 8080 # Check server status sudo vpnmanager api-status # Test with curl curl -X POST http://localhost:8080/auth/login \ -H "Content-Type: application/json" \ -d '{"username":"john","password":"password123"}' curl -X GET "http://localhost:8080/vpn/config?username=john" \ -H "Authorization: Bearer jwt_john_1640995200" ``` ## Production Deployment For production deployment: 1. **Use HTTPS**: Configure SSL/TLS certificates 2. **Set up reverse proxy**: Use Nginx or Apache 3. **Enable rate limiting**: Configure appropriate limits 4. **Monitor logs**: Set up log monitoring and alerting 5. **Backup database**: Regular database backups 6. **Update dependencies**: Keep all dependencies updated ## Support

For API support and integration help:
- Review the BarqNet documentation
- Test with the provided curl examples
- Check the API documentation files 