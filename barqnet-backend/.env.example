# ChameleonVPN / BarqNet Backend Configuration
# Copy this file to .env and update with your values
#
# ⚠️  SECURITY WARNING ⚠️
# ============================================================================
# The values below are EXAMPLES ONLY and are NOT SECURE for production use!
#
# BEFORE DEPLOYING TO PRODUCTION, YOU MUST:
# 1. Generate a strong, random JWT_SECRET (minimum 32 characters)
# 2. Use a strong database password (NOT "barqnet123")
# 3. Use a strong API_KEY (minimum 16 characters, randomly generated)
# 4. Enable SSL for database connections (DB_SSLMODE=require)
# 5. Set strong Redis password if Redis is exposed
#
# To generate secure values:
#   JWT_SECRET:  openssl rand -base64 48
#   API_KEY:     openssl rand -hex 32
#   DB_PASSWORD: openssl rand -base64 24
# ============================================================================

# ============================================================================
# Database Configuration
# ============================================================================
# NOTE: Your colleague created database as 'vpnmanager'
# Update these values to match your actual database setup:
DB_HOST=localhost
DB_PORT=5432
DB_USER=vpnmanager      # Change to 'barqnet' if you used that name
DB_PASSWORD=your_password_here  # ⚠️  SET YOUR ACTUAL PASSWORD!
DB_NAME=vpnmanager      # Change to 'barqnet' if you used that name
DB_SSLMODE=disable      # ⚠️  USE 'require' IN PRODUCTION!

# Example if you used 'barqnet' instead:
# DB_USER=barqnet
# DB_NAME=barqnet
# DB_PASSWORD=barqnet123

# ============================================================================
# API Configuration (CRITICAL SECURITY)
# ============================================================================
# ⚠️  These MUST be changed before production deployment!
# Generate with: openssl rand -base64 48 (for JWT_SECRET)
#                openssl rand -hex 32 (for API_KEY)
API_KEY=your_api_key_here                    # ⚠️  REPLACE WITH RANDOM VALUE!
JWT_SECRET=your_jwt_secret_key_here          # ⚠️  REPLACE WITH RANDOM VALUE (32+ chars)!

# ============================================================================
# Redis Configuration for Rate Limiting
# ============================================================================

# Enable or disable rate limiting (default: true)
RATE_LIMIT_ENABLED=true

# Redis connection settings
REDIS_HOST=localhost
REDIS_PORT=6379
# ⚠️  PRODUCTION REQUIREMENT: Redis password is REQUIRED for production!
# Generate with: openssl rand -base64 32
# Configure Redis: requirepass <your-password> in /etc/redis/redis.conf
REDIS_PASSWORD=GENERATE_ON_PRODUCTION_SERVER
REDIS_DB=0

# ============================================================================
# Audit Logging Configuration
# ============================================================================
# Audit logs track all system operations for security and compliance
# Supports dual logging: file-based AND database storage for redundancy

# Directory for file-based audit logs (will be created automatically)
AUDIT_LOG_DIR=/var/log/vpnmanager

# Enable/disable file-based audit logging
AUDIT_FILE_ENABLED=true

# Enable/disable database audit logging (recommended: keep enabled)
AUDIT_DB_ENABLED=true

# NOTES:
# - Both logging methods are enabled for redundancy
# - If file logging fails (permissions/disk), database logging continues
# - Ensure AUDIT_LOG_DIR is writable by the application user
# - For production, create the directory manually with proper permissions:
#     sudo mkdir -p /var/log/vpnmanager
#     sudo chown vpnmanager:vpnmanager /var/log/vpnmanager
#     sudo chmod 750 /var/log/vpnmanager

# ============================================================================
# Rate Limit Configuration
# ============================================================================

# OTP Send Rate Limit
# Maximum OTP requests per phone number within the time window
RATE_LIMIT_OTP_MAX=5
RATE_LIMIT_OTP_WINDOW_MINUTES=60

# Login Rate Limit
# Maximum login attempts per phone number within the time window
RATE_LIMIT_LOGIN_MAX=10
RATE_LIMIT_LOGIN_WINDOW_MINUTES=60

# Registration Rate Limit
# Maximum registration attempts per IP address within the time window
RATE_LIMIT_REGISTER_MAX=3
RATE_LIMIT_REGISTER_WINDOW_MINUTES=60

# General API Rate Limit
# Maximum API requests per IP address within the time window
RATE_LIMIT_API_MAX=100
RATE_LIMIT_API_WINDOW_SECONDS=60

# ============================================================================
# Email Service Configuration (Resend)
# ============================================================================
# Email service for sending OTPs and magic links
# Using Resend (resend.com) for email delivery
#
# To get started:
# 1. Sign up at resend.com (free tier: 3,000 emails/month)
# 2. Get API key from dashboard: https://resend.com/api-keys
# 3. For testing, use: onboarding@resend.dev (no domain verification needed)
# 4. For production, add custom domain at: https://resend.com/domains
#
# Email configuration:
RESEND_API_KEY=your_resend_api_key_here  # Get from: https://resend.com/api-keys
RESEND_FROM_EMAIL=no-reply@mail.barqnet.com  # For testing: onboarding@resend.dev

# Email service mode:
# - "resend" = Use Resend API (production)
# - "local"  = Log emails to console (development/testing)
EMAIL_SERVICE_MODE=local

# ============================================================================
# Notes:
# ============================================================================
# 1. Rate limiting uses Redis as the backend store for tracking request counts
# 2. If Redis is unavailable, the system operates in DEGRADED mode (allows all requests)
# 3. Rate limit headers (X-RateLimit-*) are included in API responses
# 4. 429 status code is returned when rate limits are exceeded
# 5. Set RATE_LIMIT_ENABLED=false to completely disable rate limiting
# ============================================================================
